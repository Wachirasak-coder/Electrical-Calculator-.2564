<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡∏ß‡∏™‡∏ó. 2564</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2236;
    --border: #1e3a5f;
    --accent: #00d4ff;
    --accent2: #ff6b35;
    --accent3: #00ff9d;
    --text: #e2e8f0;
    --text-muted: #64748b;
    --error: #ff4757;
    --success: #00ff9d;
    --warning: #ffa502;
    --grid: rgba(0, 212, 255, 0.03);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Sarabun', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(var(--grid) 1px, transparent 1px),
      linear-gradient(90deg, var(--grid) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* Glow orbs */
  body::after {
    content: '';
    position: fixed;
    top: -200px;
    right: -200px;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(0,212,255,0.06) 0%, transparent 70%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px 60px;
  }

  /* Header */
  header {
    padding: 30px 0 20px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .logo-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--accent), #0077aa);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 0 20px rgba(0,212,255,0.3);
  }

  .logo-text h1 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    letter-spacing: -0.5px;
  }

  .logo-text p {
    font-size: 0.78rem;
    color: var(--text-muted);
    font-family: 'IBM Plex Mono', monospace;
  }

  .badge {
    background: rgba(0,212,255,0.1);
    border: 1px solid rgba(0,212,255,0.3);
    color: var(--accent);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-family: 'IBM Plex Mono', monospace;
    letter-spacing: 1px;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 4px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 6px;
    margin-bottom: 28px;
    overflow-x: auto;
    scrollbar-width: none;
  }

  .tab-btn {
    flex: 1;
    min-width: 140px;
    padding: 12px 16px;
    background: transparent;
    border: none;
    border-radius: 10px;
    color: var(--text-muted);
    font-family: 'Sarabun', sans-serif;
    font-size: 0.88rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    white-space: nowrap;
  }

  .tab-btn.active {
    background: linear-gradient(135deg, rgba(0,212,255,0.15), rgba(0,212,255,0.05));
    color: var(--accent);
    border: 1px solid rgba(0,212,255,0.3);
    box-shadow: 0 0 15px rgba(0,212,255,0.1);
  }

  .tab-btn:hover:not(.active) {
    background: var(--surface2);
    color: var(--text);
  }

  /* Panels */
  .panel { display: none; animation: fadeIn 0.3s ease; }
  .panel.active { display: block; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Cards */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 20px;
  }

  .card-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 14px;
    border-bottom: 1px solid var(--border);
  }

  .card-title .icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
  }

  .icon-blue { background: rgba(0,212,255,0.15); }
  .icon-orange { background: rgba(255,107,53,0.15); }
  .icon-green { background: rgba(0,255,157,0.15); }
  .icon-yellow { background: rgba(255,165,2,0.15); }

  /* Form */
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 16px;
    margin-bottom: 20px;
  }

  .form-group { display: flex; flex-direction: column; gap: 6px; }

  label {
    font-size: 0.82rem;
    font-weight: 500;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  input, select {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 14px;
    color: var(--text);
    font-family: 'Sarabun', sans-serif;
    font-size: 0.95rem;
    transition: all 0.2s;
    outline: none;
    -webkit-appearance: none;
  }

  input:focus, select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,212,255,0.1);
  }

  select option { background: var(--surface2); }

  .unit-hint {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 2px;
    font-family: 'IBM Plex Mono', monospace;
  }

  /* Buttons */
  .btn-calc {
    background: linear-gradient(135deg, var(--accent), #007acc);
    border: none;
    border-radius: 12px;
    padding: 14px 32px;
    color: #000;
    font-family: 'Sarabun', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 20px rgba(0,212,255,0.25);
  }

  .btn-calc:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,212,255,0.4);
  }

  .btn-reset {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 24px;
    color: var(--text-muted);
    font-family: 'Sarabun', sans-serif;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-reset:hover { border-color: var(--accent2); color: var(--accent2); }

  .btn-row { display: flex; gap: 12px; flex-wrap: wrap; }

  /* Results */
  .result-box {
    background: linear-gradient(135deg, rgba(0,212,255,0.05), rgba(0,119,204,0.05));
    border: 1px solid rgba(0,212,255,0.2);
    border-radius: 14px;
    padding: 24px;
    margin-top: 20px;
  }

  .result-box.warning-box {
    background: linear-gradient(135deg, rgba(255,165,2,0.05), rgba(255,165,2,0.02));
    border-color: rgba(255,165,2,0.3);
  }

  .result-box.error-box {
    background: linear-gradient(135deg, rgba(255,71,87,0.05), rgba(255,71,87,0.02));
    border-color: rgba(255,71,87,0.3);
  }

  .result-title {
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-muted);
    margin-bottom: 16px;
    font-family: 'IBM Plex Mono', monospace;
  }

  .result-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
  }

  .result-item {
    background: var(--surface);
    border-radius: 10px;
    padding: 14px 16px;
    border: 1px solid var(--border);
  }

  .result-item .r-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 6px;
  }

  .result-item .r-value {
    font-size: 1.4rem;
    font-weight: 700;
    font-family: 'IBM Plex Mono', monospace;
    color: var(--accent);
  }

  .result-item .r-unit {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 2px;
    font-family: 'IBM Plex Mono', monospace;
  }

  .result-item.highlight .r-value { color: var(--accent3); }
  .result-item.warn .r-value { color: var(--warning); }
  .result-item.danger .r-value { color: var(--error); }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    margin-top: 16px;
  }

  .status-ok { background: rgba(0,255,157,0.1); color: var(--success); border: 1px solid rgba(0,255,157,0.3); }
  .status-warn { background: rgba(255,165,2,0.1); color: var(--warning); border: 1px solid rgba(255,165,2,0.3); }
  .status-fail { background: rgba(255,71,87,0.1); color: var(--error); border: 1px solid rgba(255,71,87,0.3); }

  .note-text {
    font-size: 0.82rem;
    color: var(--text-muted);
    line-height: 1.6;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid var(--border);
  }

  /* Table */
  .ref-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
    margin-top: 12px;
  }

  .ref-table th {
    background: rgba(0,212,255,0.08);
    color: var(--accent);
    padding: 10px 12px;
    text-align: left;
    font-weight: 600;
    border: 1px solid var(--border);
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .ref-table td {
    padding: 9px 12px;
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.82rem;
  }

  .ref-table tr:nth-child(even) td { background: rgba(255,255,255,0.02); }
  .ref-table tr.highlight-row td { background: rgba(0,212,255,0.08); color: var(--accent); }

  /* Divider */
  .section-divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--border), transparent);
    margin: 24px 0;
  }

  /* Tooltip / Info */
  .info-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 0.78rem;
    color: var(--text-muted);
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 2px 8px;
    font-family: 'IBM Plex Mono', monospace;
  }

  /* Formula display */
  .formula-box {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 8px;
    padding: 14px 16px;
    margin: 14px 0;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 0.85rem;
    color: var(--accent);
    line-height: 1.7;
  }

  .formula-box span { color: var(--text-muted); font-family: 'Sarabun', sans-serif; }

  /* Responsive */
  @media (max-width: 600px) {
    .tabs { gap: 2px; padding: 4px; }
    .tab-btn { min-width: 100px; font-size: 0.8rem; padding: 10px 10px; }
    .card { padding: 18px; }
  }

  .hidden { display: none; }
  .mt-8 { margin-top: 8px; }
  .mt-16 { margin-top: 16px; }

  /* Scroll behavior */
  html { scroll-behavior: smooth; }

  /* Custom scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--surface); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--accent); }
</style>
</head>
<body>
<div class="container">

  <!-- Header -->
  <header>
    <div class="logo-area">
      <div class="logo-icon">‚ö°</div>
      <div class="logo-text">
        <h1>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡∏ß‡∏™‡∏ó.</h1>
        <p>EIT Standard 2021 ¬∑ Electrical Calculation Tool</p>
      </div>
    </div>
    <span class="badge">‡∏ß‡∏™‡∏ó. 2022-2564</span>
  </header>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('wire')">üîå ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü</button>
    <button class="tab-btn" onclick="switchTab('breaker')">üîí Circuit Breaker</button>
    <button class="tab-btn" onclick="switchTab('vdrop')">üìâ Voltage Drop</button>
    <button class="tab-btn" onclick="switchTab('load')">üìä Load Calculation</button>
  </div>

  <!-- ===== TAB 1: Wire Sizing ===== -->
  <div id="panel-wire" class="panel active">
    <div class="card">
      <div class="card-title">
        <div class="icon icon-blue">üîå</div>
        ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü (Wire Sizing) ‚Äî ‡∏ß‡∏™‡∏ó. 2022-2564 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á 4
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î (Load Current)</label>
          <input type="number" id="w-current" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20" min="0" step="0.1">
          <span class="unit-hint">‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡πÅ‡∏≠‡∏°‡πÅ‡∏õ‡∏£‡πå (A)</span>
        </div>
        <div class="form-group">
          <label>‡∏ä‡∏ô‡∏¥‡∏î‡∏â‡∏ô‡∏ß‡∏ô (Insulation Type)</label>
          <select id="w-insulation">
            <option value="PVC">PVC (60¬∞C) ‚Äî THW, NYY</option>
            <option value="XLPE">XLPE (90¬∞C) ‚Äî THHN, CV</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏≤‡∏¢</label>
          <select id="w-install">
            <option value="conduit">‡∏£‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ó‡πà‡∏≠ (In Conduit)</option>
            <option value="tray">‡∏ö‡∏ô‡∏£‡∏≤‡∏á‡πÄ‡∏Ñ‡πÄ‡∏ö‡∏¥‡∏• (Cable Tray)</option>
            <option value="air">‡πÄ‡∏î‡∏¥‡∏ô‡πÉ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏® (Open Air)</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡πà‡∏≠ / ‡∏Å‡∏•‡∏∏‡πà‡∏°</label>
          <select id="w-bundle">
            <option value="1">1‚Äì3 ‡πÄ‡∏™‡πâ‡∏ô (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 1.00)</option>
            <option value="0.80">4‚Äì6 ‡πÄ‡∏™‡πâ‡∏ô (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.80)</option>
            <option value="0.70">7‚Äì9 ‡πÄ‡∏™‡πâ‡∏ô (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.70)</option>
            <option value="0.65">10‚Äì15 ‡πÄ‡∏™‡πâ‡∏ô (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.65)</option>
            <option value="0.50">‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 15 ‡πÄ‡∏™‡πâ‡∏ô (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.50)</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° (Ambient Temp)</label>
          <select id="w-temp">
            <option value="1.00">30¬∞C (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 1.00)</option>
            <option value="0.91">35¬∞C (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.91)</option>
            <option value="0.82">40¬∞C (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.82)</option>
            <option value="0.71">45¬∞C (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.71)</option>
            <option value="0.58">50¬∞C (‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö = 0.58)</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏á‡∏à‡∏£</label>
          <select id="w-circuit">
            <option value="1.0">‡∏ß‡∏á‡∏à‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (√ó1.0)</option>
            <option value="1.25">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå / ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á (√ó1.25)</option>
          </select>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-calc" onclick="calcWire()">‚ö° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
        <button class="btn-reset" onclick="resetForm('wire')">‚Ü∫ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>
    </div>

    <div id="wire-result" class="hidden">
      <div class="card">
        <div class="card-title"><div class="icon icon-green">üìã</div>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü</div>
        <div id="wire-result-content"></div>
      </div>
    </div>

    <!-- Reference Table -->
    <div class="card">
      <div class="card-title"><div class="icon icon-blue">üìñ</div>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÅ‡∏™ ‚Äî ‡∏ß‡∏™‡∏ó. 2022-2564</div>
      <table class="ref-table" id="wire-ref-table">
        <thead>
          <tr>
            <th>‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢ (mm¬≤)</th>
            <th>PVC 60¬∞C ‡πÉ‡∏ô‡∏ó‡πà‡∏≠ (A)</th>
            <th>XLPE 90¬∞C ‡πÉ‡∏ô‡∏ó‡πà‡∏≠ (A)</th>
            <th>PVC 60¬∞C ‡∏£‡∏≤‡∏á (A)</th>
            <th>XLPE 90¬∞C ‡∏£‡∏≤‡∏á (A)</th>
          </tr>
        </thead>
        <tbody id="wire-table-body"></tbody>
      </table>
    </div>
  </div>

  <!-- ===== TAB 2: Circuit Breaker ===== -->
  <div id="panel-breaker" class="panel">
    <div class="card">
      <div class="card-title">
        <div class="icon icon-orange">üîí</div>
        ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î Circuit Breaker ‚Äî ‡∏ß‡∏™‡∏ó. 2022-2564
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î (Load Current)</label>
          <input type="number" id="b-current" placeholder="‡πÄ‡∏ä‡πà‡∏ô 20" min="0" step="0.1">
          <span class="unit-hint">‡∏´‡∏ô‡πà‡∏ß‡∏¢: ‡πÅ‡∏≠‡∏°‡πÅ‡∏õ‡∏£‡πå (A)</span>
        </div>
        <div class="form-group">
          <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏´‡∏•‡∏î</label>
          <select id="b-loadtype">
            <option value="general">‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (√ó1.0)</option>
            <option value="motor">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå / Continuous (√ó1.25)</option>
            <option value="heating">‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô (√ó1.25)</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</label>
          <select id="b-voltage">
            <option value="220">220V (1 Phase)</option>
            <option value="380">380V (3 Phase)</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (mm¬≤)</label>
          <select id="b-wiresize">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö --</option>
            <option value="1.5">1.5 mm¬≤</option>
            <option value="2.5">2.5 mm¬≤</option>
            <option value="4">4 mm¬≤</option>
            <option value="6">6 mm¬≤</option>
            <option value="10">10 mm¬≤</option>
            <option value="16">16 mm¬≤</option>
            <option value="25">25 mm¬≤</option>
            <option value="35">35 mm¬≤</option>
            <option value="50">50 mm¬≤</option>
            <option value="70">70 mm¬≤</option>
            <option value="95">95 mm¬≤</option>
            <option value="120">120 mm¬≤</option>
            <option value="150">150 mm¬≤</option>
            <option value="185">185 mm¬≤</option>
            <option value="240">240 mm¬≤</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏ä‡∏ô‡∏¥‡∏î‡∏â‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏¢</label>
          <select id="b-ins">
            <option value="PVC">PVC 60¬∞C</option>
            <option value="XLPE">XLPE 90¬∞C</option>
          </select>
        </div>
        <div class="form-group">
          <label>Breaking Capacity ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
          <select id="b-ic">
            <option value="6">6 kA (‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</option>
            <option value="10">10 kA</option>
            <option value="16">16 kA</option>
            <option value="25">25 kA</option>
            <option value="36">36 kA</option>
            <option value="50">50 kA</option>
          </select>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-calc" onclick="calcBreaker()">‚ö° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
        <button class="btn-reset" onclick="resetForm('breaker')">‚Ü∫ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>
    </div>

    <div id="breaker-result" class="hidden">
      <div class="card">
        <div class="card-title"><div class="icon icon-green">üìã</div>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Circuit Breaker</div>
        <div id="breaker-result-content"></div>
      </div>
    </div>

    <!-- Standard CB sizes reference -->
    <div class="card">
      <div class="card-title"><div class="icon icon-orange">üìñ</div>‡∏Ç‡∏ô‡∏≤‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô Circuit Breaker (IEC 60898)</div>
      <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:4px;">
        <span class="info-chip">6A</span><span class="info-chip">10A</span><span class="info-chip">16A</span>
        <span class="info-chip">20A</span><span class="info-chip">25A</span><span class="info-chip">32A</span>
        <span class="info-chip">40A</span><span class="info-chip">50A</span><span class="info-chip">63A</span>
        <span class="info-chip">80A</span><span class="info-chip">100A</span><span class="info-chip">125A</span>
        <span class="info-chip">160A</span><span class="info-chip">200A</span><span class="info-chip">250A</span>
        <span class="info-chip">315A</span><span class="info-chip">400A</span><span class="info-chip">500A</span>
        <span class="info-chip">630A</span><span class="info-chip">800A</span><span class="info-chip">1000A</span>
        <span class="info-chip">1250A</span><span class="info-chip">1600A</span><span class="info-chip">2000A</span>
      </div>
      <p class="note-text">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡∏ô‡∏≤‡∏î CB ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢ (‡∏ß‡∏™‡∏ó. 2022-2564 ‡∏Ç‡πâ‡∏≠ 3.03)</p>
    </div>
  </div>

  <!-- ===== TAB 3: Voltage Drop ===== -->
  <div id="panel-vdrop" class="panel">
    <div class="card">
      <div class="card-title">
        <div class="icon icon-yellow">üìâ</div>
        ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Voltage Drop ‚Äî ‡∏ß‡∏™‡∏ó. 2022-2564 (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3% ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á)
      </div>

      <div class="formula-box">
        VD (%) = (‚àö3 √ó I √ó L √ó (R¬∑cosœÜ + X¬∑sinœÜ)) / (V √ó 1000) √ó 100
        <br><span>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 3 ‡πÄ‡∏ü‡∏™ | ‡∏´‡∏ô‡πà‡∏ß‡∏¢: I=A, L=m, R/X=Œ©/km, V=V</span>
        <br><br>
        VD (%) = (2 √ó I √ó L √ó (R¬∑cosœÜ + X¬∑sinœÜ)) / (V √ó 1000) √ó 100
        <br><span>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 1 ‡πÄ‡∏ü‡∏™</span>
      </div>

      <div class="form-grid">
        <div class="form-group">
          <label>‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î (A)</label>
          <input type="number" id="v-current" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50" min="0" step="0.1">
        </div>
        <div class="form-group">
          <label>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)</label>
          <input type="number" id="v-length" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100" min="0" step="1">
        </div>
        <div class="form-group">
          <label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢ (mm¬≤)</label>
          <select id="v-size">
            <option value="1.5">1.5 mm¬≤</option>
            <option value="2.5">2.5 mm¬≤</option>
            <option value="4">4 mm¬≤</option>
            <option value="6">6 mm¬≤</option>
            <option value="10">10 mm¬≤</option>
            <option value="16">16 mm¬≤</option>
            <option value="25">25 mm¬≤</option>
            <option value="35">35 mm¬≤</option>
            <option value="50">50 mm¬≤</option>
            <option value="70">70 mm¬≤</option>
            <option value="95">95 mm¬≤</option>
            <option value="120">120 mm¬≤</option>
            <option value="150">150 mm¬≤</option>
            <option value="185">185 mm¬≤</option>
            <option value="240">240 mm¬≤</option>
            <option value="300">300 mm¬≤</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</label>
          <select id="v-volt">
            <option value="220">220V (1 ‡πÄ‡∏ü‡∏™)</option>
            <option value="380">380V (3 ‡πÄ‡∏ü‡∏™)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Power Factor (cosœÜ)</label>
          <select id="v-pf">
            <option value="1.00">1.00 (Resistive)</option>
            <option value="0.95">0.95</option>
            <option value="0.90" selected>0.90 (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)</option>
            <option value="0.85">0.85</option>
            <option value="0.80">0.80 (‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå)</option>
            <option value="0.75">0.75</option>
          </select>
        </div>
        <div class="form-group">
          <label>‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏≤‡∏¢</label>
          <select id="v-conductor">
            <option value="Cu">‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á (Copper)</option>
            <option value="Al">‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (Aluminum)</option>
          </select>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-calc" onclick="calcVDrop()">‚ö° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
        <button class="btn-reset" onclick="resetForm('vdrop')">‚Ü∫ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>
    </div>

    <div id="vdrop-result" class="hidden">
      <div class="card">
        <div class="card-title"><div class="icon icon-green">üìã</div>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Voltage Drop</div>
        <div id="vdrop-result-content"></div>
      </div>
    </div>

    <div class="card">
      <div class="card-title"><div class="icon icon-yellow">üìñ</div>‡πÄ‡∏Å‡∏ì‡∏ë‡πå Voltage Drop ‚Äî ‡∏ß‡∏™‡∏ó. 2022-2564</div>
      <table class="ref-table">
        <thead>
          <tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏á‡∏à‡∏£</th><th>% VD ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</th><th>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</th></tr>
        </thead>
        <tbody>
          <tr><td>‡∏ß‡∏á‡∏à‡∏£‡∏¢‡πà‡∏≠‡∏¢ (Branch Circuit)</td><td>3%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.06</td></tr>
          <tr><td>‡∏ß‡∏á‡∏à‡∏£‡∏õ‡πâ‡∏≠‡∏ô (Feeder)</td><td>3%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.06</td></tr>
          <tr><td>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö (Service+Feeder+Branch)</td><td>5%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.06</td></tr>
          <tr><td>‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á (Lighting)</td><td>3%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.06</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== TAB 4: Load Calculation ===== -->
  <div id="panel-load" class="panel">
    <div class="card">
      <div class="card-title">
        <div class="icon icon-yellow">üìä</div>
        Load Calculation / Demand Factor ‚Äî ‡∏ß‡∏™‡∏ó. 2022-2564
      </div>

      <div id="load-items">
        <div class="load-item" id="item-0">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
            <span style="font-weight:600;color:var(--accent);font-size:0.85rem;">‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà 1</span>
            <button onclick="removeItem(0)" style="background:rgba(255,71,87,0.1);border:1px solid rgba(255,71,87,0.2);border-radius:6px;padding:2px 8px;color:var(--error);font-size:0.78rem;cursor:pointer;">‡∏•‡∏ö</button>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î</label>
              <input type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ä‡∏±‡πâ‡∏ô 1" class="load-name">
            </div>
            <div class="form-group">
              <label>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü (W)</label>
              <input type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1000" min="0" class="load-watts">
            </div>
            <div class="form-group">
              <label>Demand Factor (%)</label>
              <select class="load-df">
                <option value="1.00">100% ‚Äî ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡∏î</option>
                <option value="1.25">125% ‚Äî Continuous (‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå)</option>
                <option value="0.50">50% ‚Äî ‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</option>
                <option value="0.35">35% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà 10,001‚Äì20,000W</option>
                <option value="0.25">25% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 20,000W</option>
                <option value="0.80">80% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                <option value="0.60">60% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á</option>
                <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
              </select>
            </div>
            <div class="form-group">
              <label>‡∏Å‡∏≥‡∏´‡∏ô‡∏î DF ‡πÄ‡∏≠‡∏á (%)</label>
              <input type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 75" min="0" max="125" class="load-df-custom" disabled>
            </div>
            <div class="form-group">
              <label>Power Factor</label>
              <input type="number" placeholder="0.90" min="0.1" max="1" step="0.01" value="0.90" class="load-pf">
            </div>
            <div class="form-group">
              <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (pcs)</label>
              <input type="number" placeholder="1" min="1" value="1" class="load-qty">
            </div>
          </div>
        </div>
      </div>

      <div style="margin: 20px 0; display:flex;gap:10px;flex-wrap:wrap;">
        <button class="btn-reset" onclick="addLoadItem()" style="color:var(--accent);border-color:rgba(0,212,255,0.3);">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î</button>
      </div>

      <div class="section-divider"></div>

      <div class="form-grid">
        <div class="form-group">
          <label>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô</label>
          <select id="l-volt">
            <option value="220">220V (1 ‡πÄ‡∏ü‡∏™)</option>
            <option value="380">380V (3 ‡πÄ‡∏ü‡∏™)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Power Factor ‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</label>
          <input type="number" id="l-pf" placeholder="0.85" min="0.1" max="1" step="0.01" value="0.85">
        </div>
        <div class="form-group">
          <label>Diversity Factor (DF ‡∏£‡∏∞‡∏ö‡∏ö)</label>
          <input type="number" id="l-divf" placeholder="0.80" min="0.1" max="1" step="0.01" value="0.80">
          <span class="unit-hint">‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: 0.7‚Äì0.9</span>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-calc" onclick="calcLoad()">‚ö° ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Load ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="btn-reset" onclick="resetForm('load')">‚Ü∫ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
      </div>
    </div>

    <div id="load-result" class="hidden">
      <div class="card">
        <div class="card-title"><div class="icon icon-green">üìã</div>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• Load Calculation</div>
        <div id="load-result-content"></div>
      </div>
    </div>

    <!-- Demand Factor Reference -->
    <div class="card">
      <div class="card-title"><div class="icon icon-yellow">üìñ</div>Demand Factor ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏ß‡∏™‡∏ó. 2022-2564</div>
      <table class="ref-table">
        <thead>
          <tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏´‡∏•‡∏î</th><th>Demand Factor</th><th>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</th></tr>
        </thead>
        <tbody>
          <tr><td>‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á (3,500W ‡πÅ‡∏£‡∏Å)</td><td>100%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.09</td></tr>
          <tr><td>‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á (3,501‚Äì120,000W)</td><td>35%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.09</td></tr>
          <tr><td>‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á (‡πÄ‡∏Å‡∏¥‡∏ô 120,000W)</td><td>25%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.09</td></tr>
          <tr><td>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (1‚Äì3 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</td><td>100%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.09</td></tr>
          <tr><td>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (4+ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)</td><td>75%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.09</td></tr>
          <tr><td>‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå (Continuous Load)</td><td>125%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 4.01</td></tr>
          <tr><td>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</td><td>100%</td><td>‡∏ß‡∏™‡∏ó. ‡∏Ç‡πâ‡∏≠ 2.09</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
// ===================== DATA TABLES =====================

// Wire Ampacity Table (PVC 60¬∞C, XLPE 90¬∞C) ‚Äî In Conduit / Cable Tray
// [size_mm2, PVC_conduit, XLPE_conduit, PVC_tray, XLPE_tray, PVC_air, XLPE_air]
const WIRE_TABLE = [
  [1.5,   15,  19,  17,  22,  20,  26],
  [2.5,   20,  26,  23,  30,  26,  34],
  [4,     27,  35,  30,  40,  34,  44],
  [6,     35,  45,  40,  52,  44,  58],
  [10,    49,  63,  55,  73,  61,  80],
  [16,    66,  85,  74,  99,  82, 107],
  [25,    87, 112,  98, 130, 108, 141],
  [35,   105, 135, 118, 157, 131, 170],
  [50,   125, 161, 141, 187, 157, 202],
  [70,   158, 203, 178, 236, 198, 255],
  [95,   190, 244, 215, 283, 238, 305],
  [120,  220, 282, 247, 326, 276, 352],
  [150,  252, 324, 285, 376, 318, 405],
  [185,  289, 370, 327, 431, 363, 464],
  [240,  345, 440, 389, 513, 432, 552],
  [300,  396, 506, 447, 590, 496, 634],
];

// Resistance & Reactance (Œ©/km at 50Hz, 90¬∞C) ‚Äî Copper conductor
// [size_mm2, R_Cu_90, R_Al_90, X_trefoil]
const CONDUCTOR_DATA = {
  1.5:  { R_Cu: 14.48, R_Al: 24.00, X: 0.115 },
  2.5:  { R_Cu: 8.71,  R_Al: 14.50, X: 0.110 },
  4:    { R_Cu: 5.45,  R_Al: 9.06,  X: 0.107 },
  6:    { R_Cu: 3.63,  R_Al: 6.04,  X: 0.104 },
  10:   { R_Cu: 2.18,  R_Al: 3.62,  X: 0.101 },
  16:   { R_Cu: 1.36,  R_Al: 2.27,  X: 0.098 },
  25:   { R_Cu: 0.863, R_Al: 1.44,  X: 0.095 },
  35:   { R_Cu: 0.627, R_Al: 1.04,  X: 0.093 },
  50:   { R_Cu: 0.469, R_Al: 0.778, X: 0.090 },
  70:   { R_Cu: 0.328, R_Al: 0.546, X: 0.087 },
  95:   { R_Cu: 0.236, R_Al: 0.393, X: 0.084 },
  120:  { R_Cu: 0.188, R_Al: 0.313, X: 0.082 },
  150:  { R_Cu: 0.153, R_Al: 0.255, X: 0.080 },
  185:  { R_Cu: 0.123, R_Al: 0.205, X: 0.079 },
  240:  { R_Cu: 0.0943,R_Al: 0.157, X: 0.077 },
  300:  { R_Cu: 0.0775,R_Al: 0.129, X: 0.075 },
};

// Standard CB sizes
const CB_SIZES = [6,10,16,20,25,32,40,50,63,80,100,125,160,200,250,315,400,500,630,800,1000,1250,1600,2000];

// PVC ampacity in conduit (as reference for CB check)
const AMP_PVC_CONDUIT = {};
const AMP_XLPE_CONDUIT = {};
WIRE_TABLE.forEach(r => {
  AMP_PVC_CONDUIT[r[0]] = r[1];
  AMP_XLPE_CONDUIT[r[0]] = r[2];
});

// ===================== POPULATE REF TABLE =====================
function populateWireTable() {
  const tbody = document.getElementById('wire-table-body');
  tbody.innerHTML = WIRE_TABLE.map(r =>
    `<tr><td>${r[0]} mm¬≤</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td><td>${r[4]}</td></tr>`
  ).join('');
}
populateWireTable();

// ===================== TAB SWITCHING =====================
function switchTab(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('panel-' + name).classList.add('active');
  event.currentTarget.classList.add('active');
}

// ===================== RESET =====================
function resetForm(type) {
  const selectors = {
    wire: ['#w-current'],
    breaker: ['#b-current'],
    vdrop: ['#v-current','#v-length'],
    load: []
  };
  if (selectors[type]) {
    selectors[type].forEach(s => { const el = document.querySelector(s); if(el) el.value = ''; });
  }
  const r = document.getElementById(type + '-result') || document.getElementById(type === 'vdrop' ? 'vdrop-result' : type + '-result');
  if(r) r.classList.add('hidden');
}

// ===================== WIRE SIZING =====================
function calcWire() {
  const I_load = parseFloat(document.getElementById('w-current').value);
  const ins = document.getElementById('w-insulation').value;
  const install = document.getElementById('w-install').value;
  const bundleFactor = parseFloat(document.getElementById('w-bundle').value);
  const tempFactor = parseFloat(document.getElementById('w-temp').value);
  const circuitFactor = parseFloat(document.getElementById('w-circuit').value);

  if (isNaN(I_load) || I_load <= 0) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return;
  }

  // Design current after correction
  const I_design = I_load * circuitFactor;
  // Required ampacity (before derating)
  const I_required = I_design / (bundleFactor * tempFactor);

  // Find wire size
  let selected = null;
  for (let row of WIRE_TABLE) {
    let ampacity;
    if (install === 'conduit') ampacity = ins === 'PVC' ? row[1] : row[2];
    else if (install === 'tray') ampacity = ins === 'PVC' ? row[3] : row[4];
    else ampacity = ins === 'PVC' ? row[5] : row[6];

    const adjusted = ampacity * bundleFactor * tempFactor;
    if (adjusted >= I_design) {
      selected = { size: row[0], baseAmp: ampacity, adjustedAmp: adjusted };
      break;
    }
  }

  const installLabel = { conduit: '‡∏£‡πâ‡∏≠‡∏¢‡πÉ‡∏ô‡∏ó‡πà‡∏≠', tray: '‡∏£‡∏≤‡∏á‡πÄ‡∏Ñ‡πÄ‡∏ö‡∏¥‡∏•', air: '‡πÉ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®' };

  let html = `
    <div class="result-grid">
      <div class="result-item">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏î‡∏¥‡∏°</div>
        <div class="r-value">${I_load.toFixed(1)}</div>
        <div class="r-unit">A</div>
      </div>
      <div class="result-item">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö (√ó${circuitFactor})</div>
        <div class="r-value">${I_design.toFixed(1)}</div>
        <div class="r-unit">A</div>
      </div>
      <div class="result-item">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö</div>
        <div class="r-value">${I_required.toFixed(1)}</div>
        <div class="r-unit">A (before derating)</div>
      </div>
      <div class="result-item">
        <div class="r-label">Bundle Factor √ó Temp Factor</div>
        <div class="r-value">${(bundleFactor * tempFactor).toFixed(3)}</div>
        <div class="r-unit">correction factor</div>
      </div>
    </div>
  `;

  if (selected) {
    const utilization = (I_design / selected.adjustedAmp * 100).toFixed(1);
    const utilClass = utilization > 90 ? 'warn' : 'highlight';
    html += `
      <div class="section-divider"></div>
      <div class="result-grid">
        <div class="result-item highlight">
          <div class="r-label">‚úÖ ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
          <div class="r-value">${selected.size}</div>
          <div class="r-unit">mm¬≤ ${ins} ‚Äî ${installLabel[install]}</div>
        </div>
        <div class="result-item">
          <div class="r-label">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÅ‡∏™ (Base)</div>
          <div class="r-value">${selected.baseAmp}</div>
          <div class="r-unit">A (‡∏Å‡πà‡∏≠‡∏ô‡∏õ‡∏£‡∏±‡∏ö)</div>
        </div>
        <div class="result-item">
          <div class="r-label">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö</div>
          <div class="r-value">${selected.adjustedAmp.toFixed(1)}</div>
          <div class="r-unit">A (‡∏´‡∏•‡∏±‡∏á Derating)</div>
        </div>
        <div class="result-item ${utilClass}">
          <div class="r-label">% ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
          <div class="r-value">${utilization}%</div>
          <div class="r-unit">${utilization > 90 ? '‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î' : '‚úÖ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°'}</div>
        </div>
      </div>
      <span class="status-badge status-ok">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏ß‡∏™‡∏ó. 2022-2564</span>
    `;
  } else {
    html += `<div class="mt-16"><span class="status-badge status-fail">‚ùå ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á)</span></div>`;
  }

  html += `<p class="note-text">
    <strong>‡∏™‡∏π‡∏ï‡∏£:</strong> I_adjusted = I_base √ó CF_bundle √ó CF_temp ‚â• I_design<br>
    Bundle CF = ${bundleFactor} | Temp CF = ${tempFactor} | Circuit Factor = √ó${circuitFactor}<br>
    ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ‡∏ß‡∏™‡∏ó. 2022-2564 ‡∏ï‡∏≤‡∏£‡∏≤‡∏á 4, ‡∏Ç‡πâ‡∏≠ 3.02
  </p>`;

  document.getElementById('wire-result-content').innerHTML = html;
  document.getElementById('wire-result').classList.remove('hidden');
}

// ===================== CIRCUIT BREAKER =====================
function calcBreaker() {
  const I_load = parseFloat(document.getElementById('b-current').value);
  const loadtype = document.getElementById('b-loadtype').value;
  const voltage = document.getElementById('b-voltage').value;
  const wireSize = document.getElementById('b-wiresize').value;
  const ins = document.getElementById('b-ins').value;
  const ic = document.getElementById('b-ic').value;

  if (isNaN(I_load) || I_load <= 0) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return;
  }

  const factor = loadtype === 'motor' || loadtype === 'heating' ? 1.25 : 1.0;
  const I_design = I_load * factor;

  // Find next standard CB size
  let cbSize = CB_SIZES.find(s => s >= I_design);
  if (!cbSize) cbSize = '> 2000A (‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ACB)';

  // Check against wire ampacity
  let wireAmp = null;
  let wireCheck = null;
  if (wireSize) {
    wireAmp = ins === 'PVC' ? AMP_PVC_CONDUIT[parseFloat(wireSize)] : AMP_XLPE_CONDUIT[parseFloat(wireSize)];
    if (wireAmp) {
      wireCheck = typeof cbSize === 'number' ? cbSize <= wireAmp : false;
    }
  }

  let html = `
    <div class="result-grid">
      <div class="result-item">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÇ‡∏´‡∏•‡∏î</div>
        <div class="r-value">${I_load.toFixed(1)}</div>
        <div class="r-unit">A</div>
      </div>
      <div class="result-item">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö (√ó${factor})</div>
        <div class="r-value">${I_design.toFixed(1)}</div>
        <div class="r-unit">A</div>
      </div>
      <div class="result-item highlight">
        <div class="r-label">‚úÖ ‡∏Ç‡∏ô‡∏≤‡∏î CB ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
        <div class="r-value">${cbSize}</div>
        <div class="r-unit">A ‚Äî Breaking ${ic} kA</div>
      </div>
      ${wireAmp ? `
      <div class="result-item ${wireCheck ? 'highlight' : 'danger'}">
        <div class="r-label">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏¢ ${wireSize} mm¬≤ ${ins}</div>
        <div class="r-value">${wireAmp}</div>
        <div class="r-unit">A ‚Äî ${wireCheck ? '‚úÖ CB ‚â§ ‡∏™‡∏≤‡∏¢ OK' : '‚ùå CB > ‡∏™‡∏≤‡∏¢ ‡∏ú‡∏¥‡∏î!'}</div>
      </div>` : ''}
    </div>
  `;

  if (wireAmp && !wireCheck) {
    html += `<span class="status-badge status-fail">‚ùå ‡∏Ç‡∏ô‡∏≤‡∏î CB (${cbSize}A) ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏¢ (${wireAmp}A) ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô!</span>`;
  } else if (wireAmp) {
    html += `<span class="status-badge status-ok">‚úÖ CB ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏ß‡∏™‡∏ó.</span>`;
  } else {
    html += `<span class="status-badge status-ok">‚úÖ ‡∏Ç‡∏ô‡∏≤‡∏î CB ‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏ß‡∏™‡∏ó.</span>`;
  }

  html += `<p class="note-text">
    ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£: I_load √ó ${factor} ‚â§ I_CB ‚â§ I_wire (‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≤‡∏¢)<br>
    ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏ß‡∏™‡∏ó. 2022-2564 ‡∏Ç‡πâ‡∏≠ 3.03: CB ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢<br>
    Breaking Capacity ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${ic} kA (‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏•‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£ ‡∏ì ‡∏à‡∏∏‡∏î‡∏ô‡∏±‡πâ‡∏ô)
  </p>`;

  document.getElementById('breaker-result-content').innerHTML = html;
  document.getElementById('breaker-result').classList.remove('hidden');
}

// ===================== VOLTAGE DROP =====================
function calcVDrop() {
  const I = parseFloat(document.getElementById('v-current').value);
  const L = parseFloat(document.getElementById('v-length').value);
  const sizeStr = document.getElementById('v-size').value;
  const V_system = parseFloat(document.getElementById('v-volt').value);
  const pf = parseFloat(document.getElementById('v-pf').value);
  const conductor = document.getElementById('v-conductor').value;
  const size = parseFloat(sizeStr);

  if (isNaN(I) || isNaN(L) || I <= 0 || L <= 0) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return;
  }

  const cdata = CONDUCTOR_DATA[size];
  if (!cdata) { alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏¢'); return; }

  const R_per_km = conductor === 'Cu' ? cdata.R_Cu : cdata.R_Al;
  const X_per_km = cdata.X;
  const sinpf = Math.sqrt(1 - pf * pf);

  // VD calculation
  let VD_volt, VD_pct;
  if (V_system === 380) {
    // 3-phase
    VD_volt = Math.sqrt(3) * I * (L / 1000) * (R_per_km * pf + X_per_km * sinpf);
    VD_pct = (VD_volt / V_system) * 100;
  } else {
    // 1-phase
    VD_volt = 2 * I * (L / 1000) * (R_per_km * pf + X_per_km * sinpf);
    VD_pct = (VD_volt / V_system) * 100;
  }

  const V_receiving = V_system - VD_volt;
  const limit = 3.0;
  const passed = VD_pct <= limit;

  // Find minimum wire size for VD ‚â§ 3%
  let minSize = null;
  for (let [sz, d] of Object.entries(CONDUCTOR_DATA)) {
    sz = parseFloat(sz);
    const R = conductor === 'Cu' ? d.R_Cu : d.R_Al;
    const X = d.X;
    let vd;
    if (V_system === 380) {
      vd = (Math.sqrt(3) * I * (L/1000) * (R * pf + X * sinpf) / V_system) * 100;
    } else {
      vd = (2 * I * (L/1000) * (R * pf + X * sinpf) / V_system) * 100;
    }
    if (vd <= limit) { minSize = sz; break; }
  }

  let html = `
    <div class="result-grid">
      <div class="result-item">
        <div class="r-label">‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å (Volt)</div>
        <div class="r-value">${VD_volt.toFixed(2)}</div>
        <div class="r-unit">V</div>
      </div>
      <div class="result-item ${passed ? 'highlight' : 'danger'}">
        <div class="r-label">‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å (%)</div>
        <div class="r-value">${VD_pct.toFixed(2)}%</div>
        <div class="r-unit">${passed ? '‚úÖ ‚â§ 3% OK' : '‚ùå > 3% ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î!'}</div>
      </div>
      <div class="result-item">
        <div class="r-label">‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á</div>
        <div class="r-value">${V_receiving.toFixed(1)}</div>
        <div class="r-unit">V</div>
      </div>
      <div class="result-item">
        <div class="r-label">R ‡∏™‡∏≤‡∏¢ (Œ©/km, 90¬∞C)</div>
        <div class="r-value">${R_per_km}</div>
        <div class="r-unit">Œ©/km (${conductor})</div>
      </div>
    </div>
    <span class="status-badge ${passed ? 'status-ok' : 'status-fail'}">
      ${passed ? '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô VD ‚â§ 3% ‡∏ï‡∏≤‡∏° ‡∏ß‡∏™‡∏ó.' : '‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢'}
    </span>
  `;

  if (!passed && minSize) {
    html += `
      <div class="result-box mt-16">
        <div class="result-title">üí° ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‚Äî ‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà VD ‚â§ 3%</div>
        <div class="result-item highlight" style="display:inline-block;min-width:200px;">
          <div class="r-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
          <div class="r-value">${minSize}</div>
          <div class="r-unit">mm¬≤ ${conductor}</div>
        </div>
      </div>
    `;
  }

  html += `<p class="note-text">
    ‡∏™‡∏π‡∏ï‡∏£: VD = ${V_system === 380 ? '‚àö3' : '2'} √ó ${I}A √ó ${(L/1000).toFixed(3)}km √ó (${R_per_km}√ó${pf} + ${X_per_km}√ó${sinpf.toFixed(4)}) = ${VD_volt.toFixed(3)}V<br>
    %VD = ${VD_volt.toFixed(3)} / ${V_system} √ó 100 = ${VD_pct.toFixed(2)}%<br>
    ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ‡∏ß‡∏™‡∏ó. 2022-2564 ‡∏Ç‡πâ‡∏≠ 2.06 | ‡∏Ñ‡πà‡∏≤ R/X ‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á IEC 60228
  </p>`;

  document.getElementById('vdrop-result-content').innerHTML = html;
  document.getElementById('vdrop-result').classList.remove('hidden');
}

// ===================== LOAD CALCULATION =====================
let loadItemCount = 1;

// Listen for DF dropdown changes
document.addEventListener('change', function(e) {
  if (e.target.classList.contains('load-df')) {
    const custom = e.target.closest('.load-item').querySelector('.load-df-custom');
    if (e.target.value === 'custom') {
      custom.disabled = false;
      custom.focus();
    } else {
      custom.disabled = true;
      custom.value = '';
    }
  }
});

function addLoadItem() {
  const idx = loadItemCount++;
  const div = document.createElement('div');
  div.className = 'load-item';
  div.id = 'item-' + idx;
  div.innerHTML = `
    <div class="section-divider"></div>
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
      <span style="font-weight:600;color:var(--accent);font-size:0.85rem;">‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà ${idx+1}</span>
      <button onclick="removeItem(${idx})" style="background:rgba(255,71,87,0.1);border:1px solid rgba(255,71,87,0.2);border-radius:6px;padding:2px 8px;color:var(--error);font-size:0.78rem;cursor:pointer;">‡∏•‡∏ö</button>
    </div>
    <div class="form-grid">
      <div class="form-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î</label>
        <input type="text" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®" class="load-name">
      </div>
      <div class="form-group">
        <label>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏ü (W)</label>
        <input type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2500" min="0" class="load-watts">
      </div>
      <div class="form-group">
        <label>Demand Factor (%)</label>
        <select class="load-df">
          <option value="1.00">100% ‚Äî ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡∏î</option>
          <option value="1.25">125% ‚Äî Continuous (‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå)</option>
          <option value="0.50">50% ‚Äî ‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå</option>
          <option value="0.35">35% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏µ‡πà 10,001‚Äì20,000W</option>
          <option value="0.25">25% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 20,000W</option>
          <option value="0.80">80% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
          <option value="0.60">60% ‚Äî ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á</option>
          <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
        </select>
      </div>
      <div class="form-group">
        <label>‡∏Å‡∏≥‡∏´‡∏ô‡∏î DF ‡πÄ‡∏≠‡∏á (%)</label>
        <input type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 75" min="0" max="125" class="load-df-custom" disabled>
      </div>
      <div class="form-group">
        <label>Power Factor</label>
        <input type="number" placeholder="0.90" min="0.1" max="1" step="0.01" value="0.90" class="load-pf">
      </div>
      <div class="form-group">
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (pcs)</label>
        <input type="number" placeholder="1" min="1" value="1" class="load-qty">
      </div>
    </div>
  `;
  document.getElementById('load-items').appendChild(div);
}

function removeItem(idx) {
  const el = document.getElementById('item-' + idx);
  if (el) el.remove();
}

function calcLoad() {
  const items = document.querySelectorAll('.load-item');
  const voltSystem = parseFloat(document.getElementById('l-volt').value);
  const sysPF = parseFloat(document.getElementById('l-pf').value);
  const divFactor = parseFloat(document.getElementById('l-divf').value);

  if (items.length === 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î'); return; }

  let rows = [];
  let totalConnected = 0, totalDemand = 0;

  for (let item of items) {
    const name = item.querySelector('.load-name').value || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    const watts = parseFloat(item.querySelector('.load-watts').value);
    const dfSel = item.querySelector('.load-df').value;
    const dfCustom = parseFloat(item.querySelector('.load-df-custom').value);
    const pf = parseFloat(item.querySelector('.load-pf').value) || 0.9;
    const qty = parseInt(item.querySelector('.load-qty').value) || 1;

    if (isNaN(watts) || watts <= 0) continue;

    const df = dfSel === 'custom' ? (dfCustom / 100) : parseFloat(dfSel);
    const connected = watts * qty;
    const demand = connected * df;

    totalConnected += connected;
    totalDemand += demand;

    rows.push({ name, watts, qty, connected, df, demand, pf });
  }

  if (rows.length === 0) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'); return; }

  const demandAfterDiv = totalDemand * divFactor;
  const kVA = demandAfterDiv / (sysPF * 1000);

  let I_system;
  if (voltSystem === 380) {
    I_system = (demandAfterDiv) / (Math.sqrt(3) * voltSystem * sysPF);
  } else {
    I_system = demandAfterDiv / (voltSystem * sysPF);
  }

  const I_design = I_system * 1.25; // 125% for main breaker sizing

  let tableRows = rows.map((r,i) => `
    <tr>
      <td>${i+1}</td>
      <td>${r.name}</td>
      <td>${r.watts.toLocaleString()}</td>
      <td>${r.qty}</td>
      <td>${r.connected.toLocaleString()}</td>
      <td>${(r.df * 100).toFixed(0)}%</td>
      <td>${r.demand.toLocaleString()}</td>
      <td>${r.pf}</td>
    </tr>
  `).join('');

  let html = `
    <table class="ref-table">
      <thead>
        <tr>
          <th>#</th><th>‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î</th><th>W/‡∏ä‡∏¥‡πâ‡∏ô</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th>Connected (W)</th><th>DF</th><th>Demand (W)</th><th>PF</th>
        </tr>
      </thead>
      <tbody>${tableRows}</tbody>
    </table>

    <div class="section-divider"></div>
    <div class="result-grid">
      <div class="result-item">
        <div class="r-label">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏ß‡∏° (Connected)</div>
        <div class="r-value">${totalConnected.toLocaleString()}</div>
        <div class="r-unit">W (${(totalConnected/1000).toFixed(2)} kW)</div>
      </div>
      <div class="result-item">
        <div class="r-label">Demand Load (‡∏Å‡πà‡∏≠‡∏ô Diversity)</div>
        <div class="r-value">${totalDemand.toLocaleString()}</div>
        <div class="r-unit">W</div>
      </div>
      <div class="result-item">
        <div class="r-label">Demand Load (‡∏´‡∏•‡∏±‡∏á Diversity ${divFactor})</div>
        <div class="r-value">${demandAfterDiv.toLocaleString()}</div>
        <div class="r-unit">W (${(demandAfterDiv/1000).toFixed(2)} kW)</div>
      </div>
      <div class="result-item highlight">
        <div class="r-label">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏ß‡∏° (kVA)</div>
        <div class="r-value">${kVA.toFixed(2)}</div>
        <div class="r-unit">kVA (PF=${sysPF})</div>
      </div>
      <div class="result-item highlight">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏£‡∏∞‡∏ö‡∏ö</div>
        <div class="r-value">${I_system.toFixed(1)}</div>
        <div class="r-unit">A (${voltSystem}V ${voltSystem===380?'3‡πÄ‡∏ü‡∏™':'1‡πÄ‡∏ü‡∏™'})</div>
      </div>
      <div class="result-item">
        <div class="r-label">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö Main (√ó1.25)</div>
        <div class="r-value">${I_design.toFixed(1)}</div>
        <div class="r-unit">A (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Main CB)</div>
      </div>
    </div>

    <span class="status-badge status-ok">‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡∏ï‡∏≤‡∏° ‡∏ß‡∏™‡∏ó. 2022-2564</span>

    <p class="note-text">
      ‡∏™‡∏π‡∏ï‡∏£: I = P_demand / (‚àö3 √ó V √ó PF) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 3 ‡πÄ‡∏ü‡∏™ | I = P_demand / (V √ó PF) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 1 ‡πÄ‡∏ü‡∏™<br>
      Diversity Factor = ${divFactor} (‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö)<br>
      Main CB ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${I_design.toFixed(1)}A (‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö √ó 1.25)<br>
      ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ‡∏ß‡∏™‡∏ó. 2022-2564 ‡∏Ç‡πâ‡∏≠ 2.09, ‡∏Ç‡πâ‡∏≠ 3.03
    </p>
  `;

  document.getElementById('load-result-content').innerHTML = html;
  document.getElementById('load-result').classList.remove('hidden');
  document.getElementById('load-result').scrollIntoView({ behavior: 'smooth', block: 'start' });
}
</script>
</body>
</html>
